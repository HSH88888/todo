<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Todo Master 24H (Fixed)</title>
    <style>
        :root {
            --primary-color: #007aff;
            --bg-color: #f2f2f7;
            --box-bg: #ffffff;
            --text-color: #1c1c1e;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        .app-container {
            width: 100%;
            max-width: 450px;
            background: var(--box-bg);
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        /* --- í—¤ë” --- */
        .header {
            padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            background: #fff; border-bottom: 1px solid #e5e5ea; z-index: 10;
        }
        .app-title { font-size: 18px; font-weight: 800; }
        .user-btn {
            background: #eef1f5; padding: 8px 12px; border-radius: 20px;
            font-size: 14px; font-weight: 600; color: var(--primary-color);
            cursor: pointer; display: flex; align-items: center; gap: 5px;
        }
        .user-status-dot { width: 8px; height: 8px; background: #ccc; border-radius: 50%; }
        .user-status-dot.active { background: #34c759; }

        /* --- ë©”ì¸ í™”ë©´ --- */
        .date-picker-area {
            height: 140px; background: #fff; position: relative; overflow: hidden;
            border-bottom: 1px solid #e5e5ea; perspective: 1000px;
        }
        .wheel-container {
            height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory;
            padding: 50px 0; scrollbar-width: none;
        }
        .wheel-container::-webkit-scrollbar { display: none; }
        .wheel-item {
            height: 40px; display: flex; justify-content: center; align-items: center;
            font-size: 18px; color: #aaa; scroll-snap-align: center;
            transform-origin: center center; transition: all 0.1s;
        }

        .schedule-list { flex: 1; overflow-y: auto; background: #fff; }
        .time-slot { display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #f2f2f7; cursor: pointer; }
        .time-slot:active { background: #f9f9f9; }
        
        .time-label { 
            width: 60px; font-weight: 700; color: #333; font-size: 16px; 
            font-variant-numeric: tabular-nums;
        }
        .task-content { flex: 1; color: #c7c7cc; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .task-content.filled { color: #000; }

        /* --- ëª¨ë‹¬ --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100;
            justify-content: center; align-items: center; backdrop-filter: blur(3px);
        }
        .modal-box {
            background: #fff; border-radius: 20px; width: 85%; max-width: 320px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); overflow: hidden;
            display: flex; flex-direction: column; animation: popUp 0.2s ease-out;
        }
        @keyframes popUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* ì‹œê°„ ì„¤ì • ì˜ì—­ */
        .time-setter-area {
            background: #f8f8f8; padding: 15px; border-bottom: 1px solid #eee;
            display: flex; flex-direction: column; align-items: center;
        }
        .time-setter-title { font-size: 14px; color: #888; margin-bottom: 5px; }
        .time-display { 
            font-size: 28px; font-weight: 800; color: #333; 
            display: flex; align-items: center; gap: 5px;
        }
        
        /* ë¶„ ì„ íƒ íœ  */
        .minute-wheel-wrapper {
            width: 100%; height: 60px; overflow-x: scroll; white-space: nowrap;
            margin-top: 10px; scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch; scrollbar-width: none;
            border-top: 1px solid #eee; border-bottom: 1px solid #eee;
            background: #fff; display: flex; align-items: center;
            position: relative;
        }
        /* ì¤‘ì•™ ì„ íƒì„  */
        .minute-wheel-wrapper::after {
            content: ''; position: absolute; left: 50%; top: 0; bottom: 0; width: 2px;
            background: var(--primary-color); transform: translateX(-50%); opacity: 0.3; pointer-events: none;
        }

        .minute-wheel-wrapper::-webkit-scrollbar { display: none; }
        .min-item {
            display: inline-block; width: 50px; height: 50px; line-height: 50px;
            text-align: center; scroll-snap-align: center; font-size: 18px; color: #ccc;
            flex-shrink: 0; transition: all 0.2s;
        }
        .min-item.active { color: var(--primary-color); font-weight: bold; font-size: 24px; transform: scale(1.1); }

        /* í• ì¼ í”„ë¦¬ì…‹ */
        .task-preset-area { height: 120px; position: relative; overflow: hidden; perspective: 800px; background: #fff; }
        
        /* ì…ë ¥ì°½ */
        .input-row { 
            padding: 15px; background: #fff; border-top: 1px solid #eee; 
            display: flex; align-items: center; gap: 8px; position: relative;
        }
        .modal-input {
            flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 10px;
            font-size: 16px; outline: none; background: #f5f5f7;
        }
        .emoji-btn {
            font-size: 24px; cursor: pointer; padding: 5px; 
            border-radius: 50%; transition: background 0.2s;
        }
        .emoji-picker {
            display: none; grid-template-columns: repeat(6, 1fr); gap: 10px;
            padding: 15px; background: #f9f9f9; max-height: 150px; overflow-y: auto;
            border-top: 1px solid #eee;
        }
        .emoji-item { font-size: 22px; text-align: center; cursor: pointer; }

        .modal-buttons { display: flex; border-top: 1px solid #eee; }
        .modal-btn { flex: 1; padding: 15px; border: none; background: #fff; font-size: 16px; font-weight: 600; cursor: pointer; }
        .modal-btn.save { color: var(--primary-color); }
        
        .highlight-bar { position: absolute; top: 50%; left: 0; right: 0; height: 36px; margin-top: -18px; background: rgba(0,0,0,0.03); pointer-events: none; z-index: 1; }
        .user-list-area { padding: 15px; background:#fafafa; }
        .user-chip { display:inline-block; padding:5px 10px; margin:3px; background:#fff; border:1px solid #ddd; border-radius:15px; cursor:pointer;}
        .user-chip.current { border-color:var(--primary-color); color:var(--primary-color); background:#eef6ff; font-weight:bold;}

    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <div class="app-title">Todo 24H</div>
        <div class="user-btn" onclick="openUserModal()">
            <div class="user-status-dot" id="userStatusDot"></div>
            <span id="headerUserName">Guest</span>
        </div>
    </div>

    <div class="date-picker-area">
        <div class="highlight-bar"></div>
        <div class="wheel-container" id="dateWheel"></div>
    </div>

    <div class="schedule-list" id="scheduleList"></div>
</div>

<div class="modal-overlay" id="taskModal">
    <div class="modal-box">
        <div class="time-setter-area">
            <div class="time-setter-title">ì‹œê°„ ì„¤ì •</div>
            <div class="time-display">
                <span id="displayHour">00</span>
                <span>:</span>
                <span id="displayMin" style="color:var(--primary-color)">00</span>
            </div>
            <div class="minute-wheel-wrapper" id="minuteWheel"></div>
        </div>
        
        <div class="task-preset-area">
            <div class="highlight-bar"></div>
            <div class="wheel-container" id="presetWheel"></div>
        </div>

        <div class="input-row">
            <input type="text" class="modal-input" id="taskInput" placeholder="ë‚´ìš© ì…ë ¥" autocomplete="off">
            <div class="emoji-btn" onclick="toggleEmojiPicker()">â˜º</div>
        </div>
        
        <div class="emoji-picker" id="emojiPicker"></div>

        <div class="modal-buttons">
            <button class="modal-btn" onclick="closeTaskModal()">ì·¨ì†Œ</button>
            <button class="modal-btn save" onclick="saveTask()">ì €ì¥</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="userModal">
    <div class="modal-box">
        <div style="padding:15px; text-align:center; font-weight:bold; border-bottom:1px solid #eee;">ì‚¬ìš©ì ê´€ë¦¬</div>
        <div class="user-list-area" id="savedUserList"></div>
        <div style="padding:15px;">
            <input type="text" class="modal-input" id="loginIdInput" placeholder="ìƒˆ ì‚¬ìš©ì ì´ë¦„">
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="modal-btn save" style="background:var(--primary-color); color:#fff; border-radius:10px;" onclick="handleLogin()">ë¡œê·¸ì¸</button>
                <button class="modal-btn" style="background:#eee; color:#333; border-radius:10px;" onclick="handleLogout()" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
        <div class="modal-buttons"><button class="modal-btn" onclick="closeUserModal()">ë‹«ê¸°</button></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // ì„¤ì •
    const START_HOUR = 8;
    const END_HOUR = 24; 
    const PRESET_TASKS = ["(ì—†ìŒ)", "íšŒì˜", "ì—…ë¬´", "ì‹ì‚¬", "ìš´ë™", "íœ´ì‹", "ìŠ¤í„°ë””", "ì™¸ì¶œ", "ì´ë™", "ì·¨ì¹¨", "ì ê²€", "ë³´ê³ "];
    const EMOJIS = ["ğŸ˜€","ğŸ˜‚","ğŸ˜","ğŸ‘","ok","ğŸ”¥","âœ…","â¤ï¸","ğŸ˜­","ğŸ‰","âœˆï¸","ğŸ’Š","ğŸ¥","ğŸ“…","â­","â˜•","ğŸ”","ğŸº"];

    let currentUser = null;
    let selectedDate = null;
    let editingHour = 0;
    let editingMin = 0; // í˜„ì¬ ì„ íƒëœ ë¶„ (ìƒíƒœê°’)
    let todos = {}; 

    const dateWheel = document.getElementById('dateWheel');
    const scheduleList = document.getElementById('scheduleList');
    const minuteWheel = document.getElementById('minuteWheel');
    const emojiPicker = document.getElementById('emojiPicker');
    const taskInput = document.getElementById('taskInput');

    // ì´ˆê¸°í™”
    initData();
    initDateWheel();
    initPresetWheel();
    initMinuteWheel();
    initEmojiPicker();

    function initData() {
        const list = localStorage.getItem('app_user_list');
        const last = localStorage.getItem('app_last_user');
        if(last && list && list.includes(last)) switchUser(last);
        else switchUser(null);
    }

    // --- 1. ë©”ì¸ ë¡œì§ ---
    function initDateWheel() {
        dateWheel.innerHTML = '';
        const today = new Date();
        for (let i = -10; i <= 30; i++) {
            const d = new Date(); d.setDate(today.getDate() + i);
            const y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,'0'), day = String(d.getDate()).padStart(2,'0');
            const dw = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
            
            const div = document.createElement('div');
            div.className = 'wheel-item';
            div.textContent = `${m}.${day} (${dw})`;
            div.dataset.value = `${y}-${m}-${day}`;
            div.onclick = () => div.scrollIntoView({behavior:'smooth', block:'center'});
            dateWheel.appendChild(div);
            if(i === 0) selectedDate = div.dataset.value;
        }

        setupVerticalWheel(dateWheel, (val) => {
            selectedDate = val;
            renderSchedule();
        });
        
        setTimeout(() => {
            const t = Array.from(dateWheel.children).find(c => c.dataset.value === selectedDate);
            if(t) t.scrollIntoView({block:'center'});
        }, 200);
    }

    function renderSchedule() {
        scheduleList.innerHTML = '';
        if(!selectedDate) return;

        for(let h = START_HOUR; h <= END_HOUR; h++) {
            const key = `${selectedDate}-${h}`;
            let data = todos[key];
            let text = ""; let min = "00";
            
            if (typeof data === 'string') { text = data; } 
            else if (data) { text = data.text; min = String(data.min).padStart(2, '0'); }

            const div = document.createElement('div');
            div.className = 'time-slot';
            div.onclick = () => openTaskModal(h, min, text);

            div.innerHTML = `
                <div class="time-label">${h}:${min}</div>
                <div class="task-content ${text ? 'filled' : ''}">${text || 'í„°ì¹˜í•˜ì—¬ ì…ë ¥'}</div>
            `;
            scheduleList.appendChild(div);
        }
    }

    // --- 2. ì…ë ¥ ëª¨ë‹¬ (ë¶„ ì„ íƒ ìˆ˜ì •ë¨) ---
    function initMinuteWheel() {
        minuteWheel.innerHTML = '';
        // íœ  ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ íŒ¨ë”© (í™”ë©´ ë„ˆë¹„ì˜ 50% - ì•„ì´í…œ ì ˆë°˜)
        const pad = document.createElement('div'); 
        pad.style.width = "calc(50% - 25px)"; 
        pad.style.flexShrink="0";
        minuteWheel.appendChild(pad.cloneNode(true)); // ì• íŒ¨ë”©

        for (let i = 0; i < 60; i++) {
            const span = document.createElement('span');
            span.className = 'min-item';
            span.textContent = String(i).padStart(2,'0');
            span.dataset.val = i;
            span.onclick = () => {
                span.scrollIntoView({behavior:'smooth', inline:'center'});
                updateMinuteDisplay(i);
            }
            minuteWheel.appendChild(span);
        }
        
        minuteWheel.appendChild(pad.cloneNode(true)); // ë’¤ íŒ¨ë”©

        // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ (ì‹œê°ì  ì—…ë°ì´íŠ¸ìš©)
        minuteWheel.addEventListener('scroll', () => {
            requestAnimationFrame(() => {
                const center = minuteWheel.scrollLeft + minuteWheel.offsetWidth / 2;
                let closest = null; let minDiff = Infinity;
                
                document.querySelectorAll('.min-item').forEach(item => {
                    const itemCenter = item.offsetLeft + item.offsetWidth / 2;
                    const diff = Math.abs(center - itemCenter);
                    if(diff < minDiff) { minDiff = diff; closest = item; }
                    item.classList.remove('active');
                });
                
                if(closest) {
                    closest.classList.add('active');
                    // ìŠ¤í¬ë¡¤ ì¤‘ì—ë„ ìƒë‹¨ ìˆ«ìëŠ” ë°”ë€œ (ì €ì¥ ì‹œì—ëŠ” ì¬ê³„ì‚°í•˜ë¯€ë¡œ ì•ˆì „)
                    const val = parseInt(closest.dataset.val);
                    document.getElementById('displayMin').textContent = String(val).padStart(2,'0');
                }
            });
        });
    }

    function updateMinuteDisplay(m) {
        editingMin = m;
        document.getElementById('displayMin').textContent = String(m).padStart(2,'0');
    }

    // [ì¤‘ìš”] ì €ì¥ ì‹œì ì— í˜„ì¬ ì„ íƒëœ ë¶„ì„ ì •í™•íˆ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜
    function getCurrentSelectedMinute() {
        const center = minuteWheel.scrollLeft + minuteWheel.offsetWidth / 2;
        let closest = null; let minDiff = Infinity;
        document.querySelectorAll('.min-item').forEach(item => {
            const itemCenter = item.offsetLeft + item.offsetWidth / 2;
            const diff = Math.abs(center - itemCenter);
            if(diff < minDiff) { minDiff = diff; closest = item; }
        });
        return closest ? parseInt(closest.dataset.val) : 0;
    }

    function initPresetWheel() {
        const container = document.getElementById('presetWheel');
        PRESET_TASKS.forEach(t => {
            const d = document.createElement('div');
            d.className = 'wheel-item'; d.textContent = t; d.dataset.val = t;
            container.appendChild(d);
            d.onclick = () => d.scrollIntoView({behavior:'smooth', block:'center'});
        });
        setupVerticalWheel(container, (val) => {
            taskInput.value = (val === "(ì—†ìŒ)") ? "" : val;
        });
    }

    function initEmojiPicker() {
        EMOJIS.forEach(e => {
            const sp = document.createElement('div'); sp.className = 'emoji-item'; sp.textContent = e;
            sp.onclick = () => { taskInput.value += e; taskInput.focus(); };
            emojiPicker.appendChild(sp);
        });
    }
    
    window.toggleEmojiPicker = () => emojiPicker.style.display = (emojiPicker.style.display === 'grid') ? 'none' : 'grid';

    window.openTaskModal = (h, mStr, text) => {
        editingHour = h;
        const initialMin = parseInt(mStr);
        updateMinuteDisplay(initialMin);
        
        document.getElementById('displayHour').textContent = String(h).padStart(2,'0');
        taskInput.value = text;
        emojiPicker.style.display = 'none';

        document.getElementById('taskModal').style.display = 'flex';
        
        // íœ  ìœ„ì¹˜ ë™ê¸°í™” (ëª¨ë‹¬ ë Œë”ë§ ì§í›„)
        setTimeout(() => {
            const target = document.querySelector(`.min-item[data-val="${initialMin}"]`);
            if(target) target.scrollIntoView({inline:'center'});
        }, 100);
    };

    window.closeTaskModal = () => document.getElementById('taskModal').style.display = 'none';

    window.saveTask = () => {
        const val = taskInput.value.trim();
        // ì €ì¥ ë²„íŠ¼ ëˆ„ë¥´ëŠ” ìˆœê°„, íœ  ìœ„ì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ 'ë¶„'ì„ ë‹¤ì‹œ ê³„ì‚° (ë™ê¸°í™” ì˜¤ë¥˜ ë°©ì§€)
        const finalMin = getCurrentSelectedMinute();
        
        const key = `${selectedDate}-${editingHour}`;
        
        if (val) {
            todos[key] = { text: val, min: finalMin };
        } else {
            // ë‚´ìš©ì´ ë¹„ì—ˆìœ¼ë©´ ì‚­ì œí• ì§€, ì‹œê°„ë§Œ ë°”ê¿€ì§€ ê²°ì •í•´ì•¼ í•¨. 
            // ì—¬ê¸°ì„œëŠ” 'ë‚´ìš©ì´ ì—†ìœ¼ë©´ ì €ì¥ ì•ˆ í•¨'ìœ¼ë¡œ ì²˜ë¦¬ (ì˜¤ì‘ë™ ë°©ì§€)
            if(todos[key]) {
                if(confirm("ë‚´ìš©ì„ ë¹„ìš°ë©´ ì¼ì •ì´ ì‚­ì œë©ë‹ˆë‹¤. ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) delete todos[key];
                else return; // ì·¨ì†Œ
            } else {
                 return alert("í• ì¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            }
        }

        if(currentUser) localStorage.setItem(`todo_data_${currentUser}`, JSON.stringify(todos));
        renderSchedule();
        closeTaskModal();
    };

    // --- 3. ìœ í‹¸ ---
    function switchUser(id) {
        currentUser = id;
        document.getElementById('headerUserName').textContent = id ? id : "Guest";
        document.getElementById('userStatusDot').classList.toggle('active', !!id);
        document.getElementById('logoutBtn').style.display = id ? 'block' : 'none';
        
        if(id) {
            const data = localStorage.getItem(`todo_data_${id}`);
            todos = data ? JSON.parse(data) : {};
            localStorage.setItem('app_last_user', id);
        } else {
            todos = {};
            localStorage.removeItem('app_last_user');
        }
        renderSchedule();
    }

    function setupVerticalWheel(el, onSelect) {
        const update = () => {
            const center = el.scrollTop + el.offsetHeight / 2;
            let closest = null; let minDiff = Infinity;
            Array.from(el.children).forEach(c => {
                const cCenter = c.offsetTop + c.offsetHeight / 2;
                const dist = center - cCenter; const absDist = Math.abs(dist);
                const angle = dist / 10;
                const scale = Math.max(0.8, 1 - absDist/1000);
                const opacity = Math.max(0.3, 1 - absDist/150);
                c.style.transform = `rotateX(${-angle}deg) scale(${scale})`;
                c.style.opacity = opacity;
                c.style.color = (absDist < 20) ? "#000" : "#ccc";
                c.style.fontWeight = (absDist < 20) ? "bold" : "normal";
                if(absDist < minDiff) { minDiff = absDist; closest = c; }
            });
            return closest;
        };
        el.addEventListener('scroll', () => {
            requestAnimationFrame(update);
            clearTimeout(el.timer);
            el.timer = setTimeout(() => {
                const sel = update();
                if(sel && onSelect) {
                    sel.scrollIntoView({behavior:'smooth', block:'center'});
                    onSelect(sel.dataset.value || sel.dataset.val);
                }
            }, 100);
        });
        setTimeout(update, 100);
    }

    window.openUserModal = () => {
        const listDiv = document.getElementById('savedUserList'); listDiv.innerHTML = '';
        const list = JSON.parse(localStorage.getItem('app_user_list') || '[]');
        if(list.length===0) listDiv.innerHTML = '<span style="color:#aaa; font-size:13px;">ì—†ìŒ</span>';
        list.forEach(u => {
            const chip = document.createElement('span');
            chip.className = `user-chip ${u===currentUser?'current':''}`;
            chip.textContent = u;
            chip.onclick = () => { switchUser(u); closeUserModal(); };
            listDiv.appendChild(chip);
        });
        document.getElementById('userModal').style.display = 'flex';
    };
    window.closeUserModal = () => document.getElementById('userModal').style.display = 'none';

    window.handleLogin = () => {
        const name = document.getElementById('loginIdInput').value.trim();
        if(!name) return alert("ì´ë¦„ ì…ë ¥");
        let list = JSON.parse(localStorage.getItem('app_user_list') || '[]');
        if(!list.includes(name)) { list.push(name); localStorage.setItem('app_user_list', JSON.stringify(list)); }
        switchUser(name);
        document.getElementById('loginIdInput').value = '';
        closeUserModal();
    };

    window.handleLogout = () => {
        if(confirm("ë¡œê·¸ì•„ì›ƒ?")) { switchUser(null); closeUserModal(); }
    };
});
</script>
</body>
</html>
