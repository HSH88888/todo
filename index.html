<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dark Todo Master</title>
    <style>
        :root {
            /* --- ë‹¤í¬ í…Œë§ˆ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ --- */
            --bg-color: #2b2e33;       /* ì „ì²´ ë°°ê²½ */
            --box-bg: #2b2e33;         /* ì»¨í…Œì´ë„ˆ ë°°ê²½ (ë‰´ëª¨í”¼ì¦˜ì„ ìœ„í•´ ë°°ê²½ê³¼ ë™ì¼) */
            --text-main: #e0e5ec;      /* ë©”ì¸ í…ìŠ¤íŠ¸ (í°ìƒ‰ì— ê°€ê¹Œìš´ íšŒìƒ‰) */
            --text-sub: #9baacf;       /* ì„œë¸Œ í…ìŠ¤íŠ¸ */
            
            --accent-color: #ff6b6b;   /* í¬ì¸íŠ¸ ì»¬ëŸ¬ (ì˜¤ë Œì§€/ì½”ë„) */
            
            /* ë‰´ëª¨í”¼ì¦˜ ê·¸ë¦¼ì ì„¤ì • */
            --shadow-light: #35393f;   /* ë¹› ë°›ëŠ” ë¶€ë¶„ */
            --shadow-dark: #212327;    /* ê·¸ë¦¼ì ì§€ëŠ” ë¶€ë¶„ */
            
            --danger-color: #ff4757;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            background: var(--box-bg);
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
            /* PCí™”ë©´ì—ì„œ ì•±ì²˜ëŸ¼ ë³´ì´ê²Œ ê·¸ë¦¼ì ì¶”ê°€ */
            box-shadow: 0 0 30px rgba(0,0,0,0.5); 
        }

        /* --- í—¤ë” --- */
        .header {
            padding: 20px 25px;
            display: flex; justify-content: space-between; align-items: center;
            background: var(--box-bg);
            z-index: 10;
        }
        .app-title { 
            font-size: 20px; font-weight: 700; letter-spacing: 0.5px;
            color: var(--text-main);
        }
        
        /* ë‰´ëª¨í”¼ì¦˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .neu-btn {
            background: var(--bg-color);
            border-radius: 12px;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            color: var(--text-sub);
            padding: 10px 15px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex; align-items: center; gap: 8px;
            border: none;
            transition: all 0.2s ease;
        }
        .neu-btn:active {
            box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
            color: var(--accent-color);
        }
        .neu-btn.active-user {
            color: var(--accent-color);
        }
        
        .user-status-dot { width: 8px; height: 8px; background: #555; border-radius: 50%; box-shadow: inset 1px 1px 2px rgba(0,0,0,0.5); }
        .user-status-dot.active { background: var(--accent-color); box-shadow: 0 0 5px var(--accent-color); }

        /* --- ë©”ì¸ í™”ë©´ (ë‹¤ì´ì–¼ & ë¦¬ìŠ¤íŠ¸) --- */
        .date-picker-area {
            height: 160px; 
            background: var(--bg-color); 
            position: relative; overflow: hidden;
            perspective: 1000px;
            margin-bottom: 10px;
            /* ìƒë‹¨/í•˜ë‹¨ í˜ì´ë“œ íš¨ê³¼ë¥¼ ë‹¤í¬ëª¨ë“œì— ë§ê²Œ ìˆ˜ì • */
            mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
        }
        
        .wheel-container {
            height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory;
            padding: 60px 0; scrollbar-width: none;
        }
        .wheel-container::-webkit-scrollbar { display: none; }
        
        .wheel-item {
            height: 40px; display: flex; justify-content: center; align-items: center;
            font-size: 18px; color: var(--text-sub); scroll-snap-align: center;
            transform-origin: center center; transition: all 0.2s;
            opacity: 0.4;
        }
        /* ì„ íƒëœ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .wheel-item.selected-visual {
            color: var(--accent-color);
            opacity: 1;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
        }

        .schedule-list { 
            flex: 1; overflow-y: auto; 
            padding: 10px 20px;
        }
        .schedule-list::-webkit-scrollbar { display: none; }

        .time-slot { 
            display: flex; align-items: center; 
            padding: 18px 20px; margin-bottom: 12px;
            border-radius: 16px;
            background: var(--bg-color);
            /* í‰ì†Œì—” íŠ€ì–´ë‚˜ì˜¨ íš¨ê³¼ */
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            cursor: pointer;
            transition: transform 0.1s;
        }
        .time-slot:active {
            transform: scale(0.98);
            box-shadow: 2px 2px 5px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
        }
        
        .time-label { 
            width: 60px; font-weight: 700; color: var(--text-main); font-size: 16px; 
            font-variant-numeric: tabular-nums;
        }
        .task-content { 
            flex: 1; color: var(--text-sub); font-size: 15px; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
        }
        .task-content.filled { color: var(--accent-color); font-weight: 600; }
        .task-content.empty { font-style: italic; opacity: 0.5; font-size: 13px; }

        /* --- ëª¨ë‹¬ --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 100;
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .modal-box {
            background: var(--bg-color); 
            border-radius: 24px; width: 85%; max-width: 340px;
            /* ëª¨ë‹¬ ìì²´ë„ íŠ€ì–´ë‚˜ì˜¨ íš¨ê³¼ */
            box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
            padding: 25px;
            display: flex; flex-direction: column; 
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: var(--text-main);
        }
        @keyframes popUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* ì‹œê°„ ì„¤ì • ì˜ì—­ */
        .time-setter-area {
            display: flex; flex-direction: column; align-items: center; margin-bottom: 20px;
        }
        .time-display { 
            font-size: 32px; font-weight: 800; color: var(--text-main); 
            display: flex; align-items: center; gap: 5px; margin-bottom: 15px;
        }
        .time-display span.active { color: var(--accent-color); text-shadow: 0 0 10px rgba(255,107,107,0.4); }
        
        /* ë¶„ ì„ íƒ íœ  (ê°€ë¡œ) - ì˜¤ëª©í•œ íŠ¸ë™ */
        .minute-wheel-wrapper {
            width: 100%; height: 60px; overflow-x: scroll; white-space: nowrap;
            scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; scrollbar-width: none;
            
            /* ì˜¤ëª©í•œ(Pressed) ëŠë‚Œì˜ íŠ¸ë™ */
            background: var(--bg-color);
            border-radius: 30px;
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
            
            display: flex; align-items: center; position: relative;
        }
        .minute-wheel-wrapper::-webkit-scrollbar { display: none; }

        /* ì¤‘ì•™ ê°€ì´ë“œë¼ì¸ (ì‹¬í”Œí•œ ì ) */
        .minute-wheel-wrapper::after {
            content: ''; position: absolute; left: 50%; bottom: 5px; width: 4px; height: 4px;
            background: var(--accent-color); border-radius: 50%; transform: translateX(-50%);
        }

        .min-item {
            display: inline-block; width: 60px; height: 60px; line-height: 60px;
            text-align: center; scroll-snap-align: center; font-size: 16px; color: var(--text-sub);
            flex-shrink: 0; transition: all 0.2s; opacity: 0.5;
        }
        .min-item.active { 
            color: var(--accent-color); font-weight: bold; font-size: 22px; 
            opacity: 1; transform: scale(1.2); 
        }

        /* í”„ë¦¬ì…‹ íœ  */
        .task-preset-area { 
            height: 120px; position: relative; overflow: hidden; 
            margin-bottom: 20px;
            mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
        }
        
        /* ì…ë ¥ì°½ ì˜ì—­ */
        .input-group {
            display: flex; align-items: center; gap: 10px; margin-bottom: 20px;
        }
        .neu-input {
            flex: 1; padding: 15px; border-radius: 12px;
            background: var(--bg-color); border: none; outline: none;
            color: var(--text-main); font-size: 16px;
            /* ì˜¤ëª©í•œ íš¨ê³¼ (Pressed) */
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
        }
        .neu-input::placeholder { color: var(--text-sub); opacity: 0.5; }

        .icon-btn {
            width: 50px; height: 50px; border-radius: 12px;
            background: var(--bg-color);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; cursor: pointer; color: var(--text-sub);
            transition: all 0.2s;
        }
        .icon-btn:active {
            box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
            color: var(--accent-color);
        }

        /* ì´ëª¨ì§€ í”¼ì»¤ */
        .emoji-picker {
            display: none; grid-template-columns: repeat(6, 1fr); gap: 10px;
            padding: 10px; margin-bottom: 20px;
            max-height: 150px; overflow-y: auto;
            background: var(--bg-color); border-radius: 12px;
            /* ì˜¤ëª©í•œ ë°°ê²½ */
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
        }
        .emoji-item { 
            font-size: 20px; text-align: center; cursor: pointer; padding: 5px; border-radius: 5px; 
        }
        .emoji-item:hover { background: rgba(255,255,255,0.05); }

        .modal-buttons { display: flex; gap: 15px; }
        .modal-btn { 
            flex: 1; padding: 15px; border: none; border-radius: 12px;
            background: var(--bg-color); font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            color: var(--text-sub); transition: all 0.2s;
        }
        .modal-btn:active {
            box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
        }
        .modal-btn.save { color: var(--accent-color); }
        .modal-btn.cancel { color: var(--text-sub); }

        /* ì‚¬ìš©ì ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸ */
        .user-list-area { 
            padding: 15px; margin-bottom: 15px; border-radius: 12px;
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
            min-height: 50px; display: flex; flex-wrap: wrap; gap: 8px;
        }
        .user-chip { 
            padding: 8px 16px; border-radius: 20px; font-size: 14px; cursor: pointer;
            background: var(--bg-color); color: var(--text-sub);
            box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
        }
        .user-chip:active { box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light); }
        .user-chip.current { color: var(--accent-color); font-weight: bold; box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light); }

    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <div class="app-title">Todo Master</div>
        <button class="neu-btn" id="userBtn" onclick="openUserModal()">
            <div class="user-status-dot" id="userStatusDot"></div>
            <span id="headerUserName">Guest</span>
        </button>
    </div>

    <div class="date-picker-area">
        <div class="wheel-container" id="dateWheel"></div>
    </div>

    <div class="schedule-list" id="scheduleList"></div>
</div>

<div class="modal-overlay" id="taskModal">
    <div class="modal-box">
        <div class="time-setter-area">
            <div class="time-display">
                <span id="displayHour">00</span>
                <span style="opacity:0.3; margin-bottom:5px;">:</span>
                <span id="displayMin" class="active">00</span>
            </div>
            <div class="minute-wheel-wrapper" id="minuteWheel"></div>
        </div>
        
        <div class="task-preset-area">
            <div class="wheel-container" id="presetWheel"></div>
        </div>

        <div class="input-group">
            <input type="text" class="neu-input" id="taskInput" placeholder="í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
            <div class="icon-btn" onclick="toggleEmojiPicker()">â˜º</div>
        </div>
        
        <div class="emoji-picker" id="emojiPicker"></div>

        <div class="modal-buttons">
            <button class="modal-btn cancel" onclick="closeTaskModal()">ì·¨ì†Œ</button>
            <button class="modal-btn save" onclick="saveTask()">ì €ì¥</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="userModal">
    <div class="modal-box">
        <h3 style="text-align:center; margin:0 0 20px 0; color:var(--text-main);">ì‚¬ìš©ì ê³„ì •</h3>
        <div class="user-list-area" id="savedUserList"></div>
        
        <div class="input-group">
            <input type="text" class="neu-input" id="loginIdInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="modal-buttons" style="flex-direction: column; gap: 10px;">
            <button class="modal-btn save" onclick="handleLogin()">ë¡œê·¸ì¸ / ìƒì„±</button>
            <button class="modal-btn cancel" onclick="handleLogout()" id="logoutBtn" style="color:var(--danger-color)">ë¡œê·¸ì•„ì›ƒ</button>
            <button class="modal-btn cancel" onclick="closeUserModal()" style="margin-top:10px;">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- ì„¤ì • ---
    const START_HOUR = 8;
    const END_HOUR = 24; 
    const PRESET_TASKS = ["(ì—†ìŒ)", "íšŒì˜", "ì—…ë¬´", "ì‹ì‚¬", "ìš´ë™", "íœ´ì‹", "ìŠ¤í„°ë””", "ì™¸ì¶œ", "ì´ë™", "ì·¨ì¹¨", "ì ê²€", "ë³´ê³ "];
    const EMOJIS = ["ğŸ˜€","ğŸ˜‚","ğŸ˜","ğŸ‘","ok","ğŸ”¥","âœ…","â¤ï¸","ğŸ˜­","ğŸ‰","âœˆï¸","ğŸ’Š","ğŸ¥","ğŸ“…","â­","â˜•","ğŸ”","ğŸº"];

    // --- ìƒíƒœ ---
    let currentUser = null;
    let selectedDate = null;
    let editingHour = 0;
    let editingMin = 0;
    let todos = {}; 

    // --- DOM ---
    const dateWheel = document.getElementById('dateWheel');
    const scheduleList = document.getElementById('scheduleList');
    const minuteWheel = document.getElementById('minuteWheel');
    const emojiPicker = document.getElementById('emojiPicker');
    const taskInput = document.getElementById('taskInput');
    const userBtn = document.getElementById('userBtn');

    // --- ì´ˆê¸°í™” ì‹¤í–‰ ---
    initData();
    initDateWheel();
    initPresetWheel();
    initMinuteWheel();
    initEmojiPicker();

    function initData() {
        const list = localStorage.getItem('app_user_list');
        const last = localStorage.getItem('app_last_user');
        if(last && list && list.includes(last)) switchUser(last);
        else switchUser(null);
    }

    // =========================================
    // 1. ë‚ ì§œ ë° ìŠ¤ì¼€ì¤„ (ë©”ì¸)
    // =========================================
    
    function initDateWheel() {
        dateWheel.innerHTML = '';
        const today = new Date();
        for (let i = -10; i <= 30; i++) {
            const d = new Date(); d.setDate(today.getDate() + i);
            const y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,'0'), day = String(d.getDate()).padStart(2,'0');
            const dw = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
            
            const div = document.createElement('div');
            div.className = 'wheel-item';
            div.textContent = `${m}.${day} ${dw}`;
            div.dataset.value = `${y}-${m}-${day}`;
            div.onclick = () => div.scrollIntoView({behavior:'smooth', block:'center'});
            dateWheel.appendChild(div);
            if(i === 0) selectedDate = div.dataset.value;
        }

        setupVerticalWheel(dateWheel, (val) => {
            selectedDate = val;
            renderSchedule();
        });
        
        setTimeout(() => {
            const t = Array.from(dateWheel.children).find(c => c.dataset.value === selectedDate);
            if(t) t.scrollIntoView({block:'center'});
        }, 200);
    }

    function renderSchedule() {
        scheduleList.innerHTML = '';
        if(!selectedDate) return;

        for(let h = START_HOUR; h <= END_HOUR; h++) {
            const key = `${selectedDate}-${h}`;
            let data = todos[key];
            let text = ""; let min = "00";
            
            if (typeof data === 'string') { text = data; } 
            else if (data) { text = data.text; min = String(data.min).padStart(2, '0'); }

            const div = document.createElement('div');
            div.className = 'time-slot';
            div.onclick = () => openTaskModal(h, min, text);

            // í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ filled í´ë˜ìŠ¤
            const contentClass = text ? 'filled' : 'empty';
            const displayTime = `${h}:${min}`;

            div.innerHTML = `
                <div class="time-label">${displayTime}</div>
                <div class="task-content ${contentClass}">${text || 'í„°ì¹˜í•˜ì—¬ ì¼ì • ì¶”ê°€'}</div>
            `;
            scheduleList.appendChild(div);
        }
    }

    // =========================================
    // 2. ëª¨ë‹¬ ë¡œì§ (ì‹œê°„/ë¶„/í”„ë¦¬ì…‹)
    // =========================================

    function initMinuteWheel() {
        minuteWheel.innerHTML = '';
        // íŒ¨ë”©: ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´
        const pad = document.createElement('div'); 
        pad.style.width = "calc(50% - 30px)"; 
        pad.style.flexShrink="0";
        minuteWheel.appendChild(pad.cloneNode(true));

        for (let i = 0; i < 60; i++) {
            const span = document.createElement('span');
            span.className = 'min-item';
            span.textContent = String(i).padStart(2,'0');
            span.dataset.val = i;
            span.onclick = () => {
                span.scrollIntoView({behavior:'smooth', inline:'center'});
                updateMinuteDisplay(i);
            }
            minuteWheel.appendChild(span);
        }
        
        minuteWheel.appendChild(pad.cloneNode(true));

        minuteWheel.addEventListener('scroll', () => {
            requestAnimationFrame(() => {
                const center = minuteWheel.scrollLeft + minuteWheel.offsetWidth / 2;
                let closest = null; let minDiff = Infinity;
                document.querySelectorAll('.min-item').forEach(item => {
                    const itemCenter = item.offsetLeft + item.offsetWidth / 2;
                    const diff = Math.abs(center - itemCenter);
                    if(diff < minDiff) { minDiff = diff; closest = item; }
                    item.classList.remove('active');
                });
                if(closest) {
                    closest.classList.add('active');
                    const val = parseInt(closest.dataset.val);
                    document.getElementById('displayMin').textContent = String(val).padStart(2,'0');
                }
            });
        });
    }

    function updateMinuteDisplay(m) {
        editingMin = m;
        document.getElementById('displayMin').textContent = String(m).padStart(2,'0');
    }

    function getCurrentSelectedMinute() {
        const center = minuteWheel.scrollLeft + minuteWheel.offsetWidth / 2;
        let closest = null; let minDiff = Infinity;
        document.querySelectorAll('.min-item').forEach(item => {
            const itemCenter = item.offsetLeft + item.offsetWidth / 2;
            const diff = Math.abs(center - itemCenter);
            if(diff < minDiff) { minDiff = diff; closest = item; }
        });
        return closest ? parseInt(closest.dataset.val) : 0;
    }

    function initPresetWheel() {
        const container = document.getElementById('presetWheel');
        PRESET_TASKS.forEach(t => {
            const d = document.createElement('div');
            d.className = 'wheel-item'; d.textContent = t; d.dataset.val = t;
            container.appendChild(d);
            d.onclick = () => d.scrollIntoView({behavior:'smooth', block:'center'});
        });
        setupVerticalWheel(container, (val) => {
            taskInput.value = (val === "(ì—†ìŒ)") ? "" : val;
        });
    }

    function initEmojiPicker() {
        EMOJIS.forEach(e => {
            const sp = document.createElement('div'); sp.className = 'emoji-item'; sp.textContent = e;
            sp.onclick = () => { taskInput.value += e; taskInput.focus(); };
            emojiPicker.appendChild(sp);
        });
    }
    window.toggleEmojiPicker = () => emojiPicker.style.display = (emojiPicker.style.display === 'grid') ? 'none' : 'grid';

    window.openTaskModal = (h, mStr, text) => {
        editingHour = h;
        const initialMin = parseInt(mStr);
        updateMinuteDisplay(initialMin);
        
        document.getElementById('displayHour').textContent = String(h).padStart(2,'0');
        taskInput.value = text;
        emojiPicker.style.display = 'none';

        document.getElementById('taskModal').style.display = 'flex';
        
        // ë¶„ íœ  ë™ê¸°í™”
        setTimeout(() => {
            const target = document.querySelector(`.min-item[data-val="${initialMin}"]`);
            if(target) target.scrollIntoView({inline:'center'});
        }, 100);
    };

    window.closeTaskModal = () => document.getElementById('taskModal').style.display = 'none';

    window.saveTask = () => {
        const val = taskInput.value.trim();
        const finalMin = getCurrentSelectedMinute(); // ì €ì¥ ì‹œì ì˜ ë¶„ ê³„ì‚°
        const key = `${selectedDate}-${editingHour}`;
        
        if (val) {
            todos[key] = { text: val, min: finalMin };
        } else {
            if(todos[key] && confirm("ë‚´ìš©ì„ ë¹„ìš°ë©´ ì¼ì •ì´ ì‚­ì œë©ë‹ˆë‹¤. ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) delete todos[key];
            else if(!todos[key]) return alert("í• ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
        }

        if(currentUser) localStorage.setItem(`todo_data_${currentUser}`, JSON.stringify(todos));
        renderSchedule();
        closeTaskModal();
    };

    // =========================================
    // 3. ì‚¬ìš©ì ë° ìœ í‹¸
    // =========================================

    function switchUser(id) {
        currentUser = id;
        document.getElementById('headerUserName').textContent = id ? id : "Guest";
        
        // ë²„íŠ¼ í™œì„±í™” ìŠ¤íƒ€ì¼
        if(id) {
            userBtn.classList.add('active-user');
            document.getElementById('userStatusDot').classList.add('active');
            document.getElementById('logoutBtn').style.display = 'block';
            const data = localStorage.getItem(`todo_data_${id}`);
            todos = data ? JSON.parse(data) : {};
            localStorage.setItem('app_last_user', id);
        } else {
            userBtn.classList.remove('active-user');
            document.getElementById('userStatusDot').classList.remove('active');
            document.getElementById('logoutBtn').style.display = 'none';
            todos = {};
            localStorage.removeItem('app_last_user');
        }
        renderSchedule();
    }

    function setupVerticalWheel(el, onSelect) {
        const update = () => {
            const center = el.scrollTop + el.offsetHeight / 2;
            let closest = null; let minDiff = Infinity;
            Array.from(el.children).forEach(c => {
                const cCenter = c.offsetTop + c.offsetHeight / 2;
                const dist = center - cCenter; const absDist = Math.abs(dist);
                // ë‹¤í¬ëª¨ë“œìš© ì‹œê° íš¨ê³¼
                const scale = Math.max(0.85, 1 - absDist/800);
                const opacity = Math.max(0.3, 1 - absDist/150);
                c.style.transform = `scale(${scale})`;
                c.style.opacity = opacity;
                
                if(absDist < 25) { 
                    c.classList.add('selected-visual');
                } else {
                    c.classList.remove('selected-visual');
                }
                
                if(absDist < minDiff) { minDiff = absDist; closest = c; }
            });
            return closest;
        };
        el.addEventListener('scroll', () => {
            requestAnimationFrame(update);
            clearTimeout(el.timer);
            el.timer = setTimeout(() => {
                const sel = update();
                if(sel && onSelect) {
                    sel.scrollIntoView({behavior:'smooth', block:'center'});
                    onSelect(sel.dataset.value || sel.dataset.val);
                }
            }, 100);
        });
        setTimeout(update, 100);
    }

    window.openUserModal = () => {
        const listDiv = document.getElementById('savedUserList'); listDiv.innerHTML = '';
        const list = JSON.parse(localStorage.getItem('app_user_list') || '[]');
        if(list.length===0) listDiv.innerHTML = '<span style="color:var(--text-sub); font-size:13px;">ì €ì¥ëœ ì‚¬ìš©ì ì—†ìŒ</span>';
        list.forEach(u => {
            const chip = document.createElement('span');
            chip.className = `user-chip ${u===currentUser?'current':''}`;
            chip.textContent = u;
            chip.onclick = () => { switchUser(u); closeUserModal(); };
            listDiv.appendChild(chip);
        });
        document.getElementById('userModal').style.display = 'flex';
    };
    window.closeUserModal = () => document.getElementById('userModal').style.display = 'none';

    window.handleLogin = () => {
        const name = document.getElementById('loginIdInput').value.trim();
        if(!name) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”");
        let list = JSON.parse(localStorage.getItem('app_user_list') || '[]');
        if(!list.includes(name)) { list.push(name); localStorage.setItem('app_user_list', JSON.stringify(list)); }
        switchUser(name);
        document.getElementById('loginIdInput').value = '';
        closeUserModal();
    };

    window.handleLogout = () => {
        if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { switchUser(null); closeUserModal(); }
    };
});
</script>
</body>
</html>
